<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 12 RCT and IV designs | STAT 394: Causal Inference</title>
  <meta name="description" content="This is the class website for Causal Inference at Macalester College." />
  <meta name="generator" content="bookdown 0.21.6 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 12 RCT and IV designs | STAT 394: Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the class website for Causal Inference at Macalester College." />
  <meta name="github-repo" content="lmyint/causal_spring_2020" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 12 RCT and IV designs | STAT 394: Causal Inference" />
  
  <meta name="twitter:description" content="This is the class website for Causal Inference at Macalester College." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="applied-mediation-analysis.html"/>
<link rel="next" href="its-and-rd-designs.html"/>
<script src="libs/header-attrs-2.6.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #2a211c;
    color: #bdae9d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
div.sourceCode
  { color: #bdae9d; background-color: #2a211c; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffff00; } /* Alert */
code span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #44aa43; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
code span.ch { color: #049b0a; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
code span.do { color: #0066ff; font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.dv { color: #44aa43; } /* DecVal */
code span.er { color: #ffff00; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #44aa43; } /* Float */
code span.fu { color: #ff9358; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
code span.op { } /* Operator */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.sc { color: #049b0a; } /* SpecialChar */
code span.ss { color: #049b0a; } /* SpecialString */
code span.st { color: #049b0a; } /* String */
code span.va { } /* Variable */
code span.vs { color: #049b0a; } /* VerbatimString */
code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
</style>


<link rel="stylesheet" href="custom_styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "./">STAT 394: Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html"><i class="fa fa-check"></i>Schedule</a>
<ul>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-1"><i class="fa fa-check"></i>Week 1</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-2"><i class="fa fa-check"></i>Week 2</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-3"><i class="fa fa-check"></i>Week 3</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-4"><i class="fa fa-check"></i>Week 4</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-5"><i class="fa fa-check"></i>Week 5</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-6"><i class="fa fa-check"></i>Week 6</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-7"><i class="fa fa-check"></i>Week 7</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-8"><i class="fa fa-check"></i>Week 8</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#spring-break-316---327"><i class="fa fa-check"></i>Spring Break: 3/16 - 3/27</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-9-330---43"><i class="fa fa-check"></i>Week 9: 3/30 - 4/3</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-10-46---410"><i class="fa fa-check"></i>Week 10: 4/6 - 4/10</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-11-413---417"><i class="fa fa-check"></i>Week 11: 4/13 - 4/17</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-12-420---424"><i class="fa fa-check"></i>Week 12: 4/20 - 4/24</a></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html#week-13-427---51"><i class="fa fa-check"></i>Week 13: 4/27 - 5/1</a></li>
</ul></li>
<li class="part"><span><b>I Causal Diagram Fundamentals</b></span></li>
<li class="chapter" data-level="1" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html"><i class="fa fa-check"></i><b>1</b> Introductions, Review, and Motivation</a>
<ul>
<li class="chapter" data-level="" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html#learning-goals"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html#review-regression-models"><i class="fa fa-check"></i>Review: Regression Models</a></li>
<li class="chapter" data-level="" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html#exercises"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="introductions-review-and-motivation.html"><a href="introductions-review-and-motivation.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="probability-and-dags.html"><a href="probability-and-dags.html"><i class="fa fa-check"></i><b>2</b> Probability and DAGs</a>
<ul>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#learning-goals-1"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#goal-1"><i class="fa fa-check"></i>Goal 1</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#lead-in-to-r-activity-poll"><i class="fa fa-check"></i>Lead-in to R activity: Poll</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#discussion"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#r-exercises"><i class="fa fa-check"></i>R Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#conceptual-exercises"><i class="fa fa-check"></i>Conceptual Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="probability-and-dags.html"><a href="probability-and-dags.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="d-separation-part-1.html"><a href="d-separation-part-1.html"><i class="fa fa-check"></i><b>3</b> d-separation (Part 1)</a>
<ul>
<li class="chapter" data-level="" data-path="d-separation-part-1.html"><a href="d-separation-part-1.html#learning-goals-2"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-1.html"><a href="d-separation-part-1.html#discussion-d-separation"><i class="fa fa-check"></i>Discussion: d-separation</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-1.html"><a href="d-separation-part-1.html#discussion-the-birth-weight-paradox"><i class="fa fa-check"></i>Discussion: The Birth Weight Paradox</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html"><i class="fa fa-check"></i><b>4</b> d-separation (Part 2)</a>
<ul>
<li class="chapter" data-level="" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html#learning-goals-3"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html#why-care"><i class="fa fa-check"></i>Why care?</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html#example-folic-acid-and-birth-defects"><i class="fa fa-check"></i>Example: Folic Acid and Birth Defects</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html#example-selection-bias"><i class="fa fa-check"></i>Example: Selection Bias</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html#example-estrogens-and-uterine-cancer"><i class="fa fa-check"></i>Example: Estrogens and Uterine Cancer</a></li>
<li class="chapter" data-level="" data-path="d-separation-part-2.html"><a href="d-separation-part-2.html#principles-of-building-causal-diagrams"><i class="fa fa-check"></i>Principles of building causal diagrams</a></li>
</ul></li>
<li class="part"><span><b>II Causal Effect Estimation</b></span></li>
<li class="chapter" data-level="5" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html"><i class="fa fa-check"></i><b>5</b> Estimating causal effects</a>
<ul>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#learning-goals-4"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#exercise-dag-construction"><i class="fa fa-check"></i>Exercise: DAG construction</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#warm-up-d-separation"><i class="fa fa-check"></i>Warm-up: d-separation</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#discussion-estimating-causal-effects"><i class="fa fa-check"></i>Discussion: Estimating causal effects</a>
<ul>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#worksheet-developing-ideas"><i class="fa fa-check"></i>Worksheet: developing ideas</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#notes-deriving-inverse-probability-weighting"><i class="fa fa-check"></i>Notes: deriving inverse probability weighting</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#exercise-simulation-planning"><i class="fa fa-check"></i>Exercise: Simulation planning</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#simulation-example"><i class="fa fa-check"></i>Simulation example</a></li>
<li class="chapter" data-level="" data-path="estimating-causal-effects.html"><a href="estimating-causal-effects.html#on-your-own"><i class="fa fa-check"></i>On your own</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ip-weighting-in-practice.html"><a href="ip-weighting-in-practice.html"><i class="fa fa-check"></i><b>6</b> IP weighting in practice</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-in-practice.html"><a href="ip-weighting-in-practice.html#learning-goals-5"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-in-practice.html"><a href="ip-weighting-in-practice.html#discussion-1"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-in-practice.html"><a href="ip-weighting-in-practice.html#analysis"><i class="fa fa-check"></i>Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html"><i class="fa fa-check"></i><b>7</b> IP weighting for censoring</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html#learning-goals-6"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html#discussion-2"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html#exercises-1"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html#part-1-modeling-to-obtain-weights"><i class="fa fa-check"></i>Part 1: Modeling to obtain weights</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-for-censoring.html"><a href="ip-weighting-for-censoring.html#part-2-fitting-msms"><i class="fa fa-check"></i>Part 2: Fitting MSMs</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Causal Discovery</b></span></li>
<li class="chapter" data-level="8" data-path="causal-discovery.html"><a href="causal-discovery.html"><i class="fa fa-check"></i><b>8</b> Causal Discovery</a>
<ul>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#learning-goals-7"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#discussion-3"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercises-2"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-5-1"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-6"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-7"><i class="fa fa-check"></i>Exercise 7</a></li>
<li class="chapter" data-level="" data-path="causal-discovery.html"><a href="causal-discovery.html#exercise-8"><i class="fa fa-check"></i>Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Sensitivity Analyses</b></span></li>
<li class="chapter" data-level="9" data-path="sensitivity-analyses-for-unmeasured-confounding.html"><a href="sensitivity-analyses-for-unmeasured-confounding.html"><i class="fa fa-check"></i><b>9</b> Sensitivity Analyses for Unmeasured Confounding</a>
<ul>
<li class="chapter" data-level="" data-path="sensitivity-analyses-for-unmeasured-confounding.html"><a href="sensitivity-analyses-for-unmeasured-confounding.html#learning-goals-8"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="sensitivity-analyses-for-unmeasured-confounding.html"><a href="sensitivity-analyses-for-unmeasured-confounding.html#exercises-3"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="part"><span><b>V Mediation Analysis</b></span></li>
<li class="chapter" data-level="10" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html"><i class="fa fa-check"></i><b>10</b> Graphical Structure of Mediation</a>
<ul>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#learning-goals-9"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#warm-up"><i class="fa fa-check"></i>Warm-up</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#exercises-4"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#background"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-mediation.html"><a href="graphical-structure-of-mediation.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html"><i class="fa fa-check"></i><b>11</b> Applied Mediation Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#learning-goals-10"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#discussion-4"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercises-5"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#data-context"><i class="fa fa-check"></i>Data context</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercise-2-4"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercise-3-4"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercise-4-2"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercise-5-2"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="applied-mediation-analysis.html"><a href="applied-mediation-analysis.html#exercise-6-1"><i class="fa fa-check"></i>Exercise 6</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Study Designs</b></span></li>
<li class="chapter" data-level="12" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html"><i class="fa fa-check"></i><b>12</b> RCT and IV designs</a>
<ul>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#learning-goals-11"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#warm-up-1"><i class="fa fa-check"></i>Warm-up</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#discussion-5"><i class="fa fa-check"></i>Discussion</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#exercises-6"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#iv-assumptions"><i class="fa fa-check"></i>IV assumptions</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#simulation-planning"><i class="fa fa-check"></i>Simulation planning</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#simulation-setting-up-helper-functions"><i class="fa fa-check"></i>Simulation: setting up helper functions</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#running-the-simulation"><i class="fa fa-check"></i>Running the simulation</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#instruments-in-practice"><i class="fa fa-check"></i>Instruments in practice</a></li>
<li class="chapter" data-level="" data-path="rct-and-iv-designs.html"><a href="rct-and-iv-designs.html#iv-estimation-and-rcts"><i class="fa fa-check"></i>IV estimation and RCTs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="its-and-rd-designs.html"><a href="its-and-rd-designs.html"><i class="fa fa-check"></i><b>13</b> ITS and RD designs</a>
<ul>
<li class="chapter" data-level="" data-path="its-and-rd-designs.html"><a href="its-and-rd-designs.html#learning-goals-12"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="its-and-rd-designs.html"><a href="its-and-rd-designs.html#exercises-7"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="its-and-rd-designs.html"><a href="its-and-rd-designs.html#regression-discontinuity-models"><i class="fa fa-check"></i>Regression discontinuity models</a></li>
<li class="chapter" data-level="" data-path="its-and-rd-designs.html"><a href="its-and-rd-designs.html#interrupted-time-series-models"><i class="fa fa-check"></i>Interrupted time series models</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Homework</b></span></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html"><i class="fa fa-check"></i>Homework 1</a>
<ul>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#conceptual-exercises-1"><i class="fa fa-check"></i>Conceptual Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-2-5"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-3-5"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#simulation-exercises"><i class="fa fa-check"></i>Simulation Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-4-3"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-5-3"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-6-2"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#exercise-7-1"><i class="fa fa-check"></i>Exercise 7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#portfolio"><i class="fa fa-check"></i>Portfolio</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html"><i class="fa fa-check"></i>Homework 2</a>
<ul>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#in-class-activities-estimating-causal-effects"><i class="fa fa-check"></i>In-class activities: Estimating causal effects</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#in-class-activities-ip-weighting-in-practice"><i class="fa fa-check"></i>In-class activities: IP weighting in practice</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html"><i class="fa fa-check"></i>Homework 3</a></li>
<li class="part"><span><b>VIII Projects</b></span></li>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html"><i class="fa fa-check"></i>Portfolio</a>
<ul>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html#required-topics"><i class="fa fa-check"></i>Required Topics</a>
<ul>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html#post-1"><i class="fa fa-check"></i>Post 1</a></li>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html#post-2"><i class="fa fa-check"></i>Post 2</a></li>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html#post-3"><i class="fa fa-check"></i>Post 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html#iterative-progress"><i class="fa fa-check"></i>Iterative Progress</a></li>
<li class="chapter" data-level="" data-path="portfolio-1.html"><a href="portfolio-1.html#building-a-personal-website"><i class="fa fa-check"></i>Building a Personal Website</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 394: Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rct-and-iv-designs" class="section level1" number="12">
<h1><span class="header-section-number">Topic 12</span> RCT and IV designs</h1>
<div id="learning-goals-11" class="section level2 unnumbered">
<h2>Learning Goals</h2>
<ol style="list-style-type: decimal">
<li>Use d-separation ideas to understand the assumptions behind instrumental variables estimation</li>
<li>Implement a simulation of data arising from an IV design</li>
<li>Use simulation to understand properties of IV estimation</li>
<li>Evaluate the validity of potential instruments in research settings</li>
<li>Relate the IV approach to imperfect randomized trials</li>
</ol>
<p><br><br><br><br></p>
</div>
<div id="warm-up-1" class="section level2 unnumbered">
<h2>Warm-up</h2>
<center>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
BREAKING: Randomized trial EPICOS will study <a href="https://twitter.com/hashtag/tenofovir?src=hash&amp;ref_src=twsrc%5Etfw">#tenofovir</a> for the prevention of <a href="https://twitter.com/hashtag/COVID19?src=hash&amp;ref_src=twsrc%5Etfw">#COVID19</a> in 4000 health care workers in Spain.<br><br>Participants will receive tenofovir (an HIV drug) or hydroxychloroquine (a malaria drug) or both or placebo.<br><br>Led by Julia del Amo<a href="https://t.co/aLNf6Sytcm">https://t.co/aLNf6Sytcm</a>
</p>
— Miguel Hernán (<span class="citation">@_MiguelHernan</span>) <a href="https://twitter.com/_MiguelHernan/status/1247311480967630849?ref_src=twsrc%5Etfw">April 6, 2020</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p><strong>Question:</strong> For studying the effect of tenofovir on risk of developing COVID-19…</p>
<ul>
<li>What might a possible instrumental variables study design look like?</li>
<li>What might a possible regression discontinuity design look like?</li>
<li>What might a possible interrupted times series design look like?</li>
</ul>
<p><br><br><br><br></p>
</div>
<div id="discussion-5" class="section level2 unnumbered">
<h2>Discussion</h2>
<p>There are 4 core assumptions underlying an IV analysis:</p>
<ol style="list-style-type: decimal">
<li><strong>Relevance:</strong> The instrument is associated with the treatment</li>
<li><strong>Exclusion restriction:</strong> The instrument only affects the outcome <em>through the treatment variable <span class="math inline">\(A\)</span></em> (no direct effect of instrument on <span class="math inline">\(Y\)</span>)</li>
<li><strong>Randomized assignment:</strong> The instrument and the outcome do not have common causes. The instrument is as if randomly assigned.</li>
<li><strong>Monotonicity:</strong> There are no “defiers”. When there are no defiers, the IV estimate ends up generalizing only to the compliers and is thus called a <strong>complier average causal effect (CACE)</strong> or a <strong>local average treatment effect (LATE)</strong>.<br />
Let <span class="math inline">\(A^{IV}\)</span> be the potential outcome for the treatment variable depending on the value of the instrument <span class="math inline">\(IV\)</span>.<br />
Four <em>compliance types</em> or <em>principal strata</em>:
<ul>
<li><em>Always-takers</em>: Individuals who always take treatment, regardless of what their IV assigned. i.e., <span class="math inline">\(A^{IV=0} = 1, A^{IV=1} = 1\)</span></li>
<li><em>Never-takers</em>: Individuals who never take treatment, regardless of what their IV assigned. i.e., <span class="math inline">\(A^{IV=0} = 0, A^{IV=1} = 0\)</span></li>
<li><em>Compliers</em>: Individuals who will take treatment when assigned and not when not assigned. i.e., <span class="math inline">\(A^{IV=0} = 0, A^{IV=1} = 1\)</span></li>
<li><em>Defiers</em>: Individuals who will take treatment when assigned and not when not assigned. i.e., <span class="math inline">\(A^{IV=0} = 1, A^{IV=1} = 0\)</span></li>
</ul></li>
</ol>
<p>The first three assumptions are <strong>instrumental conditions</strong>. The fourth assumption affects the population to which the IV estimate generalizes.</p>
<p>For more detail about assumption 4, see Chapter 16 of our WHATIF book.</p>
<p><br><br><br><br></p>
</div>
<div id="exercises-6" class="section level2 unnumbered">
<h2>Exercises</h2>
<p>A template Rmd is available <a href="template_rmds/12-rct-iv.Rmd">here</a>.</p>
<div id="iv-assumptions" class="section level3 unnumbered">
<h3>IV assumptions</h3>
<p>Using d-separation ideas, explain why the first three assumptions are needed for instrumental variables estimation.</p>
<p><br><br></p>
</div>
<div id="simulation-planning" class="section level3 unnumbered">
<h3>Simulation planning</h3>
<p>We will be implementing a simulation study to understand statistical properties of IV estimation. Before we jump in, let’s plan:</p>
<ul>
<li>How will we set up a setting where we know the true value of the causal effect? (Think about simulating DAGs.)</li>
<li>We will also be thinking of <em>uncertainty quantification</em>. That is, we will be looking at properties of confidence intervals for effect estimates.</li>
</ul>
<p><br><br></p>
</div>
<div id="simulation-setting-up-helper-functions" class="section level3 unnumbered">
<h3>Simulation: setting up helper functions</h3>
<p>Functions are a great way to organize code, repeat tasks, and avoid errors by modularizing key chunks of a workflow. We will construct several functions to help with our simulation.</p>
<p>First, complete the <code>get_sim_data()</code> function below. (There are several missing pieces.) This function simulates data according to the DAG shown in our video.</p>
<ul>
<li>Note that it takes 3 <strong>arguments</strong>. How are these arguments used within the function?</li>
<li>If you need to simulate any exogenous variables (variables with no causes), simulate them with a 50% probability of equaling 1.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="rct-and-iv-designs.html#cb40-1" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb40-2"><a href="rct-and-iv-designs.html#cb40-2" aria-hidden="true"></a></span>
<span id="cb40-3"><a href="rct-and-iv-designs.html#cb40-3" aria-hidden="true"></a>get_sim_data &lt;-<span class="st"> </span><span class="cf">function</span>(n, p_A_IV0, p_A_IV1) {</span>
<span id="cb40-4"><a href="rct-and-iv-designs.html#cb40-4" aria-hidden="true"></a>    p_AfromIV &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">case_when</span>(</span>
<span id="cb40-5"><a href="rct-and-iv-designs.html#cb40-5" aria-hidden="true"></a>        IV<span class="op">==</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span>p_A_IV1,</span>
<span id="cb40-6"><a href="rct-and-iv-designs.html#cb40-6" aria-hidden="true"></a>        IV<span class="op">==</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>p_A_IV0</span>
<span id="cb40-7"><a href="rct-and-iv-designs.html#cb40-7" aria-hidden="true"></a>    )</span>
<span id="cb40-8"><a href="rct-and-iv-designs.html#cb40-8" aria-hidden="true"></a>    p_AfromC &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">case_when</span>(</span>
<span id="cb40-9"><a href="rct-and-iv-designs.html#cb40-9" aria-hidden="true"></a>        C<span class="op">==</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="fl">0.5</span>,</span>
<span id="cb40-10"><a href="rct-and-iv-designs.html#cb40-10" aria-hidden="true"></a>        C<span class="op">==</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb40-11"><a href="rct-and-iv-designs.html#cb40-11" aria-hidden="true"></a>    )</span>
<span id="cb40-12"><a href="rct-and-iv-designs.html#cb40-12" aria-hidden="true"></a>    p_A &lt;-<span class="st"> </span>p_AfromIV<span class="op">*</span>p_AfromC</span>
<span id="cb40-13"><a href="rct-and-iv-designs.html#cb40-13" aria-hidden="true"></a>    A &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p_A)</span>
<span id="cb40-14"><a href="rct-and-iv-designs.html#cb40-14" aria-hidden="true"></a></span>
<span id="cb40-15"><a href="rct-and-iv-designs.html#cb40-15" aria-hidden="true"></a>    A_IVdo0 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p_A_IVdo0)</span>
<span id="cb40-16"><a href="rct-and-iv-designs.html#cb40-16" aria-hidden="true"></a>    A_IVdo1 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p_A_IVdo1)</span>
<span id="cb40-17"><a href="rct-and-iv-designs.html#cb40-17" aria-hidden="true"></a></span>
<span id="cb40-18"><a href="rct-and-iv-designs.html#cb40-18" aria-hidden="true"></a>    p_YfromA &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">case_when</span>(</span>
<span id="cb40-19"><a href="rct-and-iv-designs.html#cb40-19" aria-hidden="true"></a>        A<span class="op">==</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="fl">0.6</span>,</span>
<span id="cb40-20"><a href="rct-and-iv-designs.html#cb40-20" aria-hidden="true"></a>        A<span class="op">==</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb40-21"><a href="rct-and-iv-designs.html#cb40-21" aria-hidden="true"></a>    )</span>
<span id="cb40-22"><a href="rct-and-iv-designs.html#cb40-22" aria-hidden="true"></a>    p_YfromC &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">case_when</span>(</span>
<span id="cb40-23"><a href="rct-and-iv-designs.html#cb40-23" aria-hidden="true"></a>        C<span class="op">==</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="fl">0.7</span>,</span>
<span id="cb40-24"><a href="rct-and-iv-designs.html#cb40-24" aria-hidden="true"></a>        C<span class="op">==</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="fl">0.4</span></span>
<span id="cb40-25"><a href="rct-and-iv-designs.html#cb40-25" aria-hidden="true"></a>    )</span>
<span id="cb40-26"><a href="rct-and-iv-designs.html#cb40-26" aria-hidden="true"></a>    p_Y &lt;-<span class="st"> </span>p_YfromA<span class="op">*</span>p_YfromC</span>
<span id="cb40-27"><a href="rct-and-iv-designs.html#cb40-27" aria-hidden="true"></a>    Y &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p_Y)</span>
<span id="cb40-28"><a href="rct-and-iv-designs.html#cb40-28" aria-hidden="true"></a></span>
<span id="cb40-29"><a href="rct-and-iv-designs.html#cb40-29" aria-hidden="true"></a>    Y_Ado0 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p_Y_Ado0)</span>
<span id="cb40-30"><a href="rct-and-iv-designs.html#cb40-30" aria-hidden="true"></a>    Y_Ado1 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p_Y_Ado1)</span>
<span id="cb40-31"><a href="rct-and-iv-designs.html#cb40-31" aria-hidden="true"></a></span>
<span id="cb40-32"><a href="rct-and-iv-designs.html#cb40-32" aria-hidden="true"></a>    sim_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(IV, C, A, A_IVdo0, A_IVdo1, Y, Y_Ado0, Y_Ado1)</span>
<span id="cb40-33"><a href="rct-and-iv-designs.html#cb40-33" aria-hidden="true"></a>    sim_data</span>
<span id="cb40-34"><a href="rct-and-iv-designs.html#cb40-34" aria-hidden="true"></a>}</span></code></pre></div>
<p>Next, complete the functions below to obtain the ACE (<span class="math inline">\(P(Y^{a=1}=1)-P(Y^{a=0}=1)\)</span>) and the CACE.</p>
<ul>
<li>These functions take as input a <code>data</code> argument. We will be supplying the results of <code>get_sim_data()</code>, so you can assume that the <code>sim_data</code> variable names are present.</li>
<li>Examples of using <code>filter()</code>:
<ul>
<li><code>filter(A==1)</code> filters down to the treated</li>
<li><code>filter(A==1 | C==1)</code> filters down to the rows where <code>A = 1</code> OR <code>C = 1</code></li>
<li><code>filter(A==1 &amp; C==1)</code> filters down to the rows where <code>A = 1</code> AND <code>C = 1</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="rct-and-iv-designs.html#cb41-1" aria-hidden="true"></a>get_ace &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb41-2"><a href="rct-and-iv-designs.html#cb41-2" aria-hidden="true"></a>}</span>
<span id="cb41-3"><a href="rct-and-iv-designs.html#cb41-3" aria-hidden="true"></a></span>
<span id="cb41-4"><a href="rct-and-iv-designs.html#cb41-4" aria-hidden="true"></a>get_cace &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb41-5"><a href="rct-and-iv-designs.html#cb41-5" aria-hidden="true"></a>    data_subs &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb41-6"><a href="rct-and-iv-designs.html#cb41-6" aria-hidden="true"></a><span class="st">        </span><span class="kw">filter</span>()</span>
<span id="cb41-7"><a href="rct-and-iv-designs.html#cb41-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>Next complete the <code>get_iv_estimate()</code> function below to implement the instrumental variables estimate of the causal effect of treatment:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="rct-and-iv-designs.html#cb42-1" aria-hidden="true"></a>get_iv_estimate &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb42-2"><a href="rct-and-iv-designs.html#cb42-2" aria-hidden="true"></a>    component1 &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb42-3"><a href="rct-and-iv-designs.html#cb42-3" aria-hidden="true"></a><span class="st">        </span><span class="kw">group_by</span>(IV) <span class="op">%&gt;%</span></span>
<span id="cb42-4"><a href="rct-and-iv-designs.html#cb42-4" aria-hidden="true"></a><span class="st">        </span><span class="kw">summarize</span>(???) <span class="op">%&gt;%</span></span>
<span id="cb42-5"><a href="rct-and-iv-designs.html#cb42-5" aria-hidden="true"></a><span class="st">        </span><span class="kw">pull</span>(???) <span class="op">%&gt;%</span></span>
<span id="cb42-6"><a href="rct-and-iv-designs.html#cb42-6" aria-hidden="true"></a><span class="st">        </span><span class="kw">diff</span>()</span>
<span id="cb42-7"><a href="rct-and-iv-designs.html#cb42-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>The <code>bootstrap_iv_estimate()</code> function below performs 1000 bootstrapping iterations to get 1000 IV estimates. Add comments to document what each piece of code does.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="rct-and-iv-designs.html#cb43-1" aria-hidden="true"></a>bootstrap_iv_estimate &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb43-2"><a href="rct-and-iv-designs.html#cb43-2" aria-hidden="true"></a>    <span class="kw">replicate</span>(<span class="dv">1000</span>, {</span>
<span id="cb43-3"><a href="rct-and-iv-designs.html#cb43-3" aria-hidden="true"></a>        data_resampled &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="kw">nrow</span>(data), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb43-4"><a href="rct-and-iv-designs.html#cb43-4" aria-hidden="true"></a>        <span class="kw">get_iv_estimate</span>(data_resampled)</span>
<span id="cb43-5"><a href="rct-and-iv-designs.html#cb43-5" aria-hidden="true"></a>    })</span>
<span id="cb43-6"><a href="rct-and-iv-designs.html#cb43-6" aria-hidden="true"></a>}</span></code></pre></div>
<p><br><br></p>
</div>
<div id="running-the-simulation" class="section level3 unnumbered">
<h3>Running the simulation</h3>
<p>Now let’s actually run the simulation study! The for-loop below loops over different values of a parameter <span class="math inline">\(p\)</span> for <span class="math inline">\(p \in \{0.05,0.15,0.25,0.35,0.45\}\)</span>.</p>
<p>Fill in the question marks below. When you run this code, it will take a little while.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="rct-and-iv-designs.html#cb44-1" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">394</span>)</span>
<span id="cb44-2"><a href="rct-and-iv-designs.html#cb44-2" aria-hidden="true"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="kw">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.45</span>,<span class="fl">0.1</span>)) {</span>
<span id="cb44-3"><a href="rct-and-iv-designs.html#cb44-3" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;p=&quot;</span>, p, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-4"><a href="rct-and-iv-designs.html#cb44-4" aria-hidden="true"></a>    sim_data &lt;-<span class="st"> </span><span class="kw">get_sim_data</span>(<span class="dt">n =</span> <span class="fl">1e5</span>, <span class="dt">p_A_IV0 =</span> p, <span class="dt">p_A_IV1 =</span> <span class="dv">1</span><span class="op">-</span>p)</span>
<span id="cb44-5"><a href="rct-and-iv-designs.html#cb44-5" aria-hidden="true"></a>    ace &lt;-<span class="st"> </span>???</span>
<span id="cb44-6"><a href="rct-and-iv-designs.html#cb44-6" aria-hidden="true"></a>    cace &lt;-<span class="st"> </span>???</span>
<span id="cb44-7"><a href="rct-and-iv-designs.html#cb44-7" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;ACE (whole pop):&quot;</span>, ace, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-8"><a href="rct-and-iv-designs.html#cb44-8" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;CACE:&quot;</span>, cace, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-9"><a href="rct-and-iv-designs.html#cb44-9" aria-hidden="true"></a>    iv_estim &lt;-<span class="st"> </span><span class="kw">get_iv_estimate</span>(sim_data)</span>
<span id="cb44-10"><a href="rct-and-iv-designs.html#cb44-10" aria-hidden="true"></a>    boot_iv_results &lt;-<span class="st"> </span><span class="kw">bootstrap_iv_estimate</span>(sim_data)</span>
<span id="cb44-11"><a href="rct-and-iv-designs.html#cb44-11" aria-hidden="true"></a>    boot_ci &lt;-<span class="st"> </span><span class="kw">quantile</span>(boot_iv_results, <span class="dt">probs =</span> ???) <span class="co"># 95% CI</span></span>
<span id="cb44-12"><a href="rct-and-iv-designs.html#cb44-12" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;IV results:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-13"><a href="rct-and-iv-designs.html#cb44-13" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;    Estimate:&quot;</span>, iv_estim, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-14"><a href="rct-and-iv-designs.html#cb44-14" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;    95% bootstrap CI:&quot;</span>, boot_ci, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-15"><a href="rct-and-iv-designs.html#cb44-15" aria-hidden="true"></a>    <span class="kw">cat</span>(<span class="st">&quot;    CI width:&quot;</span>, <span class="kw">diff</span>(boot_ci), <span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb44-16"><a href="rct-and-iv-designs.html#cb44-16" aria-hidden="true"></a>}</span></code></pre></div>
<p>Form some conclusions from the results:</p>
<ul>
<li>There is a notion of an instrument being “strong” or “weak”, which relates to how strongly the instrument influences/predicts the treatment <span class="math inline">\(A\)</span>. Does increasing <span class="math inline">\(p\)</span> correspond to a stronger or weaker instrument?</li>
<li>What do you notice about how well the IV estimate predicts the average causal effect? The complier average causal effect?</li>
<li>What do you notice about how the confidence intervals change with changing instrument strength?</li>
</ul>
<p><br><br><br><br></p>
</div>
<div id="instruments-in-practice" class="section level3 unnumbered">
<h3>Instruments in practice</h3>
<p>Some examples of instruments used in health services research are below. In light of the assumptions underlying IV estimation, do you think that these instruments could be valid? (Validity of an instrument refers to the assumptions being met.) What threats to validity do you foresee?</p>
<ul>
<li><p>Randomized encouragement designs: Physicians or patients are randomly assigned to receive encouragement (e.g., promotional materials) to use certain treatments.</p></li>
<li><p>Preference-based instruments: individual physicians, hospitals, or care providers have varied and “random” preferences for one treatment over others.</p></li>
<li><p>Distance to a specialty care provider: A special health service may only be offered at certain locations. Distance to such a specialty care provider might be random across patients and also impact whether or not a patient receives the special health service.</p></li>
</ul>
<p><a href="https://effectivehealthcare.ahrq.gov/products/instrumental-variable-methods/research">This article</a> provides more examples and is also a great review article about instrumental variables in general. It has great discussion about considerations for reporting results from IV analyses and also discusses a generalization of our IV estimator (also called the Wald estimator): two-stage least squares. If you are curious about any of these ideas, ask the instructor!</p>
<p><br><br><br><br></p>
</div>
<div id="iv-estimation-and-rcts" class="section level3 unnumbered">
<h3>IV estimation and RCTs</h3>
<p>The issue of noncompliance in randomized trials was raised in the video. Noncompliance occurs when an individual does not comply with the treatment that was randomly assigned.</p>
<ul>
<li>Compared to the usual causal diagram depicting a (perfect) randomized trial, how does a randomized trial with noncompliance compare?</li>
<li>How could instrumental variables estimation be useful in this setting?</li>
<li>In an IV analysis, to whom does the effect estimate generalize, and why might this be a concern in practice?</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="applied-mediation-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="its-and-rd-designs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
